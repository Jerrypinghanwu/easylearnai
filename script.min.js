const links=document.querySelectorAll('a[href^="#"]');links.forEach(e=>{e.addEventListener("click",t=>{const n=e.getAttribute("href");if(!n||"#"===n)return;const o=document.querySelector(n);o&&(t.preventDefault(),o.scrollIntoView({behavior:"smooth",block:"start"}))})});const revealEls=document.querySelectorAll(".card, .col"),io=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.style.transform="translateY(0)",e.target.style.opacity="1",io.unobserve(e.target))})},{threshold:.08});revealEls.forEach(e=>{e.style.transform="translateY(8px)",e.style.opacity="0",e.style.transition="transform .35s ease, opacity .35s ease",io.observe(e)}),document.querySelectorAll(".btn").forEach(e=>{e.addEventListener("click",function(e){const t=document.createElement("span");t.style.cssText="\n      position: absolute;\n      border-radius: 50%;\n      background: rgba(255, 255, 255, 0.4);\n      transform: scale(0);\n      animation: ripple 0.6s ease-out;\n      pointer-events: none;\n    ";const n=this.getBoundingClientRect(),o=Math.max(n.width,n.height);t.style.width=t.style.height=o+"px",t.style.left=e.clientX-n.left-o/2+"px",t.style.top=e.clientY-n.top-o/2+"px",this.appendChild(t),setTimeout(()=>t.remove(),600)})});const menuToggle=document.querySelector(".menu-toggle"),mobileMenu=document.getElementById("mobile-menu");menuToggle&&mobileMenu&&(menuToggle.addEventListener("click",()=>{const e=!("true"===menuToggle.getAttribute("aria-expanded"));menuToggle.setAttribute("aria-expanded",String(e)),mobileMenu.hidden=!e}),mobileMenu.addEventListener("click",e=>{"A"===e.target.tagName&&(mobileMenu.hidden=!0,menuToggle.setAttribute("aria-expanded","false"))})),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").catch(()=>{})});const newsletterForm=document.getElementById("newsletter-form");if(newsletterForm){const e=document.getElementById("newsletter-email"),t=document.getElementById("newsletter-submit"),n=document.getElementById("newsletter-feedback");let o=!1;const r=e=>e.replace(/<[^>]*>/g,"").trim(),s=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),l=e=>{n&&(n.textContent=e,e&&setTimeout(()=>{n.textContent=""},5e3))},a=e=>{o=e,t&&(t.disabled=e,t.textContent=e?"訂閱中…":"立即訂閱")},i=async()=>{if(o)return;const t=e?r(e.value):"";if(!t||t.length>254)l("請輸入有效的 Email");else if(s(t)){a(!0),l("");try{const n=newsletterForm.getAttribute("action")||"https://app.convertkit.com/forms/8866341/subscriptions",o=new FormData(newsletterForm);!o.has("email_address")&&t&&o.append("email_address",t);const r=await fetch(n,{method:"POST",body:o,headers:{Accept:"application/json"}});a(!1),r.ok?(l("感謝訂閱！"),e&&(e.value="")):l("送出失敗，請稍後再試")}catch{a(!1),l("送出失敗，請檢查網路連線")}}else l("請輸入有效的 Email")};newsletterForm.addEventListener("submit",e=>{e.preventDefault(),i()})}